# 微机原理笔记——8086微处理器

8086 是一种单片微处理芯片，其内部数据总线的宽度是 16 位，外部数据总线宽度也是 
16 位，地址总线为 20 位，直接寻址 1 MB，片内包含有控制计算机所有功能的各种电路。

8086 CPU 内部由两大独立功能部件组成，**总线接口部件**（BIU）和**执行部件**（EU）。

![](D:\Pictures\Saved Pictures\Study\mcpu\8086.png)

EU 的主要功能：

+ 从指令队列中==取出指令代码==，由 EU 控制器进行译码后控制各部件完成指令规定的操作；
+ 对操作数进行算数和逻辑运算，并将运算结果的特征状态存==放在标志寄存器中==；
+ 当需要与主存储器或 I/O 端口传送数据时，==EU 向 BIU 发出命令==，并提供要访问的内存地址或 I/O 端口地址以及传送的数据

BIU 的主要功能：

+ 预取指令序列，存放在指令队列；
+ 将访问主存的逻辑地址转换成实际的物理地址。

## 1.1 寄存器结构

1. 通用寄存器

   8086 含 4 个 16 位数据寄存器，它们又可分为 8 个 8 位寄存器，即：

   + **AX —— AH，AL**，（Accumulator Register，累加器）多用于存放中间运算结果。所有 I/O 指令必须都通过 AX 与接口传送信息；
   + **BX —— BH，BL**，（Base Register，基址寄存器）在间接寻址中用于存放基地址；
   + **CX —— CH，CL**，（Counter Register，计数寄存器）用于在移位指令或串指令中作为计数用；
   + **DX —— DH，DL**，（Data Register，数据寄存器）在 32 位乘除法运算时，存放高 16 位数；在间接寻址的 I/O 指令中存放 I/O 端口地址。 

2. 段寄存器

   + **CS**（Code Segment）：代码段寄存器，用于存放正在运行的程序代码所在段的段地址，相应的偏移地址则有 IP 提供；
   + **DS**（Data Segment）：数据段寄存器，指出当前程序使用的数据所存放段的最低地址，即存放数据段的段初始地址；
   + ES（Extra Segment）：附加段寄存器，指出当前程序使用的附加数据段的段初始地址，该段是串操作指令中目的串所在的段；
   + SS（Stack Segment）：堆栈段寄存器，指出当前堆栈的底部地址，即存放堆栈段的段初始地址。

3. 指针和变址寄存器  

   + **SP**（Stack Pointer）：堆栈指针寄存器，其内容为栈顶的偏移地址，入栈指令 PUSH 和出栈指令 POP 由 SP 给出栈顶的偏移地址；
   + **BP**（Base Pointer）：基址指针寄存器，常用于在访问内存时存放内存单元的偏移地址。
   + **SI**（Source Index，源变址寄存器）和 **DI**（Destination Index，目标变址寄存器 ） ：在某些间接寻址方式中，用来存放段内偏移量的全部或一部分。在字符串操作指令中，SI 用作源变址寄存器，DI 用作目标变址寄存器。

4. 控制寄存器

   + 指令指针（**IP**，Instruction Pointer） 16 位指预令指针寄存器，其内容为下一条要执行的指令的**偏移地址**。  

   + 标志寄存器 **FLAGS**，16位寄存器，实际只用 9 位，其中 6 位是状态标志位，3 位是控制标志位

     ![](D:\Pictures\Saved Pictures\Study\mcpu\FLAGS.png)

     | 状态标志位                                 | 简介                                                         |
     | ------------------------------------------ | ------------------------------------------------------------ |
     | 进位标志位（CF，Carry Flag）               | 运算结果的最高位有进位或有借位，则 CF=1                      |
     | 奇偶标志位（PF，ParityFlag）               | 若运算结果的低 8 位中含有偶数个 1 ，则 PF = 1                |
     | 辅助进位标志位（AF，Auxiliary carry Flag） | 若运算结果的低 4 位向高 4 位（即D~3~位向D~4~位）产生进位或借位，则 AF =  1 |
     | 零标志位（ZF，Zero Flag）                  | 若运算结果为 0 ，则 ZF = 1                                   |
     | 符号标志位（SF，Sign Flag）                | 它与运算结果的最高位相同                                     |
     | 溢出标志位（OF，Overflow Flag）            | 当补码运算有溢出时（字节运算为-128\~+127，字运算为-32768\~+32767），OF = 1 |

     | 控制标志位                                  | 简介                                                         |
     | ------------------------------------------- | ------------------------------------------------------------ |
     | 方向标志位（DF，Direction Flag）            | 用于串操作指令，指定字符串处理时的方向。设置 DF = 0 时，每执行一次串操作指令，地址指针内容自动递增；反之则递减。可指令设置或清除 DF 位 |
     | 中断允许标志位（IF，Interrupt Enable Flag） | 用于控制 8086 是否允许接收外部中断请求。设置 IF = 1 时，允许响应可屏蔽中断请求； |
     | 单步标志位（TF，Trap Flag）                 | 为了调试程序而设定的陷阱控制位。设置 TF = 1时，使 CPU 进入单步执行指令工作方式，此时 CPU 每执行一条指令就产生一次内部中断 |

## 1.2 总线工作周期

**时钟周期**：一个时钟脉冲的时间，8086 的主频为 5 MHz，则一个时钟为 200 ns

**总线周期**：CPU 从存储器或外设存或取一个字节或字所需的时间。一个基本的总线周期由 4 个时钟周期组成，且分别称为T~1~，T~2~，T~3~，T~4~

**指令周期**：一条指令从开始取指令道最后执行完毕所需的时间，一个指令周期由一个或若干个总线周期组成

